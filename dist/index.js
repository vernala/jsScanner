!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("jsqr"),require("jimp")):"function"==typeof define&&define.amd?define([,],t):"object"==typeof exports?exports.scanner=t(require("jsqr"),require("jimp")):e.scanner=t(e[void 0],e[void 0])}(global,(function(e,t){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t,n){"use strict";n.r(t);var r,o=n(0),i=n.n(o),a=n(1),c=n.n(a),u="file".concat((new Date).getTime()),d=function(e){return new Promise((function(t){var n=new FileReader;n.readAsDataURL(e),n.onload=function(e){e&&e.target&&e.target.result&&c.a.read(e.target.result).then((function(e){var n=e.bitmap,r=n.data,o=n.width,a=n.height,c=i()(r,o,a),d=document.getElementById(u);d&&d.remove(),t(c?c.data:c)})).catch((function(e){t(null),console.error(e)}))}}))},l=null,s=0,f=null,m=!1,p="canvas".concat((new Date).getTime()),v="canvas".concat((new Date).getTime()),g=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,y=function(e,t){l&&(l.beginPath(),l.moveTo(e.x,e.y),l.lineTo(t.x,t.y),l.lineWidth=3,l.strokeStyle="red",l.stroke())},h=function(){m=!1,cancelAnimationFrame(s),r&&r.remove(),l=null,f&&(f.getTracks().map((function(e){return e.stop()})),f=null)};t.default={videoCancel:h,videoScanner:function(){return new Promise((function(e){m=!0,r=function(){var e=document.getElementById(p);return e&&e.remove(),(e=document.createElement("canvas")).style.position="fixed",e.style.top="100vh",e.style.left="100vw",e.style.width="100vw",e.style.height="100vh",e.style.display="none",document.body.append(e),l=e.getContext("2d"),e}();var t,n=function(){var e=document.getElementById(v);return e&&e.remove(),e=document.createElement("video")}();(t={video:{facingMode:"environment"}},navigator.mediaDevices?navigator.mediaDevices.getUserMedia(t):g?new Promise((function(e,n){return g(t,e,n)})):(navigator.userAgent.toLowerCase().match(/chrome/)&&window.location.origin.indexOf("https://")<0?console.error("获取浏览器录音功能，因安全性问题，需要在localhost 或 127.0.0.1 或 https 下才能获取权限！"):alert("对不起：未识别到扫描设备!"),Promise.reject(new Error("api not found")))).then((function(t){f=t,n.srcObject=t,n.setAttribute("playsinline","true"),n.setAttribute("webkit-playsinline","true"),n.addEventListener("loadedmetadata",(function(){n.play(),function e(t,n){if(l){if(t.readyState===t.HAVE_ENOUGH_DATA){var o=t.videoWidth,a=t.videoHeight;r.width=o,r.height=a,l.drawImage(t,0,0,o,a);try{var c=l.getImageData(0,0,o,a),u=i()(c.data,c.width,c.height,{inversionAttempts:"dontInvert"});if(u){var d=u.location;y(d.topLeftCorner,d.topRightCorner),y(d.topRightCorner,d.bottomRightCorner),y(d.bottomRightCorner,d.bottomLeftCorner),y(d.bottomLeftCorner,d.topLeftCorner),u.data&&(h(),n&&n(u.data))}else console.error("识别失败，请检查二维码是否正确！")}catch(e){console.error("识别失败，请检查二维码是否正确！",e)}}m&&(s=requestAnimationFrame((function(){e(t,n)})))}else m=!1,cancelAnimationFrame(s)}(n,e)}))})).catch((function(t){e(null),console.error(t.name+"："+t.message+"，"+t.constraint)}))}))},imageScanner:function(){return new Promise((function(e){var t,n;t=e,(n=document.getElementById(u))&&n.remove(),(n=document.createElement("input")).id=u,n.style.display="none",n.type="file",n.accept="image/*",document.body.append(n),n.addEventListener("change",(function(e){d(e.target.files[0]).then(t)})),n.click()}))},getImageQrData:d}}])}));